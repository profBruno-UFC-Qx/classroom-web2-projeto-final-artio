// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ARTIST
  CLIENT 
  COMMON_USER
}

model User {
  username          String    @id @unique
  name              String
  email             String    @unique
  password          String
  description       String?
  role              UserRole  @default(CLIENT)   
  socialmedia       String?   
  createdProjects          Project[] @relation("ArtistProject")
  contractedProjects       Project[] @relation("ContractedProject")
  collaborations           Collaborator[]
  createdRequests                 Request[] @relation("ContractedRequest")
  requestList                Request[] @relation("RequestList")
}

enum ProjectStatus{
  PENDING
  IN_PROGRESS
  REVIEWING
  COMPLETED
  CANCELED
}

model Project {
  id                String   @id @default(uuid())
  name              String
  isPublic          Boolean       @default(false)
  description       String?
  notes             String?
  status            ProjectStatus @default(PENDING)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  authorId          String
  author            User          @relation("ArtistProject", fields: [authorId], references: [username])
  clientId          String?
  client            User?         @relation("ContractedProject", fields: [clientId], references: [username])
  collaborators     Collaborator[]
}

model Collaborator {
  userId           String
  projectId        String
  user             User          @relation(fields: [userId], references: [username])
  project          Project       @relation(fields: [projectId], references: [id])
  
  @@id([userId, projectId])
}

model Request{
  id                String      @id @default(uuid())
  artistId          String
  clientId          String
  title             String
  description       String?
  startOffer        Float?     @default(0.0)
  artist            User       @relation("RequestList", fields: [artistId], references: [username])
  client            User       @relation("ContractedRequest", fields: [clientId], references: [username])
  dateOfRequest     DateTime   @default(now())
  dateOfApproval    DateTime?
}